{# inspired by Perlkonig's Grav Knowledge Base theme #}
{# https://github.com/Perlkonig/grav-theme-knowledge-base #}

  <article class="{{ article.template }}" data-url="{{ article.url }}">
    {% include "_articles/_block/article_figure.html.twig" with { 'article': article } %}
    <header>
      <h1>{{ article.title }}</h1>
    </header>
    {% include "_articles/_block/article_main.html.twig" with { 'article': article } %}


{% set catlist = taxonomy.taxonomy["category"]|keys %}
{% if grav.theme.config.params.articles.blacklist is defined %}
    {% set blist = grav.theme.config.params.articles.blacklist %}
    {% set tmplst = [] %}
    {% for cat in catlist %}
        {% if cat not in blist %}
            {% set tmplst = tmplst|merge([cat]) %}
        {% endif %}
    {% endfor %}
    {% set catlist = tmplst %}
{% endif %}

    {% set taxname = uri.query('name') %}
    {% set taxval = uri.query('val') %}

    {% if taxname %}
        {% if taxname == 'category' %}
            {% if taxval %}
                <section class="topiclist">
                    <h1>{{ 'CATEGORY'|t }} {{ taxval }}</h1>
                    {% include '_articles/_block/topiclist.html.twig' with {'articles': taxonomy.findTaxonomy({(taxname): taxval})} %}
                </section>
            {% else %}
                <section>
                    <h1>Categories</h1>
                    <ul>
                    {% for cat in catlist|sort %}
                        <li><a href="{{ base_url }}/search/taxonomy?name=category&amp;val={{ cat|url_encode }}">{{ cat }}</a></li>
                    {% endfor %}
                    </ul>
                </section>
            {% endif %}
        {% elseif taxname == 'tag' %}
            {% if taxval %}
                <section class="topiclist">
                    <h1>Tag: {{ taxval }}</h1>
                    {% include '_articles/_block/topiclist.html.twig' with {'articles': taxonomy.findTaxonomy({(taxname): taxval})} %}
                </section>
            {% else %}
                <section>
                    <h1>Tags</h1>
                    <ul>
                    {% for tag in taxonomy.taxonomy["tag"]|keys|sort %}
                        <li><a href="{{ base_url }}/search/taxonomy?name=tag&amp;val={{ tag|url_encode }}">{{ tag }}</a></li>
                    {% endfor %}
                    </ul>
            {% endif %}
        {% elseif taxname == 'action' %}
            {% if taxval %}
                <section class="topiclist">
                    <h1>Tag: {{ taxval }}</h1>
                    {% include '_articles/_block/topiclist.html.twig' with {'articles': taxonomy.findTaxonomy({(taxname): taxval})} %}
                </section>
            {% else %}
                <section>
                    <ul>
                    {% for action in taxonomy.taxonomy["action"]|keys|sort %}
                        <li><a href="{{ base_url }}/search/taxonomy?name=action&amp;val={{ action|url_encode }}">{{ action }}</a></li>
                    {% endfor %}
                    </ul>
            {% endif %}
        {% endif %}
    {% else %}
        <section>
            <h1>Taxonomies</h1>
            <ul>
                <li><a href="{{ page.url }}?name=category">Categories</a></li>
                <li><a href="{{ page.url }}?name=tag">Tags</a></li>
                <li><a href="{{ page.url }}?name=action">Actions</a></li>
            </ul>
        </section>
    {% endif %}
    <!-- user/themes/photon/templates/_articles/_block/taxonomy.html.twig -->

  </article>
