{% set page_title = header.title ~ ' | ' ~ site.title %}
{% set page_description = page.summary|striptags|rtrim|regex_replace( '/\n/', ' - ' ) %}
{% set featured_image = base_url_absolute ~ page.url ~ '/' ~ page.header.featured_image %}
{% block head %}

<head>

<title>{{ page_title }}</title>

<!-- meta -->
{% include '_site/meta.html.twig'  %}

<!-- favicon -->
{% block favicon %}
  {#- TODO put favicon in config #}
  <link rel="icon"  href="/images/favicon.png">
{% endblock favicon %}

{% if config.organization.google_search %}
<meta name="google-site-verification" content="{{ config.organization.google_search }}" />
{% endif %}

{% if config.organization.owa_siteid %}

<!-- Start Open Web Analytics Tracker -->
<script type="text/javascript">
//<![CDATA[
var owa_baseUrl = 'https://logs.photon-platform.net/';
var owa_cmds = owa_cmds || [];
owa_cmds.push(['setSiteId', '{{ config.organization.owa_siteid }}']);
owa_cmds.push(['trackPageView']);
owa_cmds.push(['trackClicks']);

(function() {
var _owa = document.createElement('script'); _owa.type = 'text/javascript'; _owa.async = true;
owa_baseUrl = ('https:' == document.location.protocol ? window.owa_baseSecUrl || owa_baseUrl.replace(/http:/, 'https:') : owa_baseUrl );
_owa.src = owa_baseUrl + 'modules/base/js/owa.tracker-combined-min.js';
var _owa_s = document.getElementsByTagName('script')[0]; _owa_s.parentNode.insertBefore(_owa, _owa_s);
}());
//]]>
</script>
<!-- End Open Web Analytics Code -->

{% endif %}

<!-- rss -->
{% block rss %}
  <link rel="alternate" href="{{ page.url ~ '.rss' }}" title="{{ page_title }}" type="application/atom+xml">
{% endblock rss %}

<!-- schema -->
{% block schema %}
{% include '_json-ld/article.html.twig'  %}
{% if page.template != "article" %}
{% include "_json-ld/#{ page.template }.html.twig" ignore missing %}
{% endif %}
{% endblock schema %}

<!-- opengraph -->
{% block opengraph %}
<meta property="og:title" content="{{ page_title }}">
<meta property="og:description" content="{{ page_description }}">
<meta property="og:image" content="{{ featured_image }}">
<meta property="og:url" content="{{ page.url }}">
<meta name="twitter:card" content="{{ featured_image }}">
{% endblock opengraph %}

{% block stylesheets %}
{% do assets.add('theme://css/photon.css', {priority:50, group:'photon'} ) %}
{% endblock %}

<!-- CSS photon -->
{{ assets.css('photon') }}
<!-- CSS photon-plugins -->
{{ assets.css('photon-plugins') }}
<!-- CSS  -->
{{ assets.css() }}

<!-- CSS fonts -->
{% block css_fonts %}
{% include '_site/fonts.html.twig'  %}
{% endblock css_fonts %}

<!-- CSS vars -->
{% block css_vars %}
{% include '_site/css_vars.html.twig'   %}
{% endblock css_vars %}

{% block javascripts %}
{%- do assets.add( 'https://code.jquery.com/jquery-3.2.1.slim.min.js',
  {'priority':1001} ) %}
{% if browser.getBrowser == 'msie' and browser.getVersion >= 8 and browser.getVersion <= 9 %}
{% do assets.add('https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js',
  {'priority':101, 'loading':'defer'} ) %}
{% do assets.add('https://oss.maxcdn.com/respond/1.4.2/respond.min.js',
  {'priority':101, 'loading':'defer'} ) %}
{% endif %}

{%- do assets.add('https://cdnjs.cloudflare.com/ajax/libs/gsap/1.20.3/TweenMax.min.js',
  {'priority':101, 'loading':'defer'} ) %}

{%- do assets.addJs('theme://js/article.js',
  {'priority':200, 'pipeline':false, 'loading':'defer', 'group':'photon' }) %}
{%- do assets.addJs('theme://js/showcase.js',
  {'priority':300, 'pipeline':false, 'loading':'defer', 'group':'photon' }) %}
{% endblock javascripts %}

<!-- JS -->
{{ assets.js() }}
<!-- JS photon -->
{{ assets.js('photon') }}
<!-- JS photon-plugins -->
{{ assets.js('photon-plugins') }}


</head>
{% endblock head %}
